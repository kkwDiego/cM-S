{"name":"24 - T04 - Shell - Earth","type":"script","author":"GrjyIKCXZF9zDqJk","img":"modules/tokenmagic/gui/macros/images/24%20-%20T04%20-%20Shell%20-%20Earth.webp","scope":"global","command":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myEarthField\",\n    shieldType: 4,\n    gridPadding: 2,\n    color: 0xBB9070,\n    time: 0,\n    blend: 1,\n    intensity: 1.25,\n    lightAlpha: 1,\n    lightSize: 0.7,\n    scale: 1,\n    radius: 1,\n    chromatic: false,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0015, \n        animType: \"move\" \n      }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.359Mw23cvaEDevkP"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669687967423,"modifiedTime":1669687967423,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"34QNSgwZeZZpWpdv"}
{"author":"GrjyIKCXZF9zDqJk","command":"/** This compendium link macro will always call the most recent version from the compendium included with this module meaning you do not need to reimport newer versions. The source of the macros that get called is https://gitlab.com/symonsch/my-foundryvtt-macros/-/tree/main/PF2e */\nasync function _executeMacroByName(\n    macroName,\n    compendiumName = \"xdy-pf2e-workbench.asymonous-benefactor-macros-internal\"\n) {\n    const pack = game.packs.get(compendiumName);\n    if (pack) {\n        const macro_data = (await pack.getDocuments()).find((i) => i.name === macroName)?.toObject();\n        if (macro_data) {\n            const temp_macro = new Macro(macro_data);\n            temp_macro.permission.default = CONST.DOCUMENT_PERMISSION_LEVELS.OWNER;\n            temp_macro.execute();\n        } else {\n            ui.notifications.error(\"Macro \" + macroName + \" not found\");\n        }\n    } else {\n        ui.notifications.error(\"Compendium \" + compendiumName + \" not found\");\n    }\n}\n_executeMacroByName('XDY DO_NOT_IMPORT Countdown-Cooldown');\n\n/* This compendium link macro is based on one originally posted by DrentalBot: https://discord.com/channels/880968862240239708/880975811279204402/910490804554973274; and modified by Mark Pearce https://discord.com/channels/880968862240239708/880969174661353484/972962446098702376 */","flags":{"core":{"sourceId":"Compendium.xdy-pf2e-workbench.asymonous-benefactor-macros.IlERHmnb1D4j1Fdz"}},"img":"icons/tools/navigation/compass-worn-copper.webp","name":"Countdown-Cooldown","scope":"global","type":"script","ownership":{"default":1,"GrjyIKCXZF9zDqJk":3},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.4.2","coreVersion":"10.290","createdTime":1670013675102,"modifiedTime":1670013715570,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"6MY2iyOQpg4wrj2j"}
{"author":"GrjyIKCXZF9zDqJk","command":"/** This compendium link macro will always call the most recent version from the compendium included with this module meaning you do not need to reimport newer versions. The source of the macros that get called is https://gitlab.com/symonsch/my-foundryvtt-macros/-/tree/main/PF2e */\nasync function _executeMacroByName(\n    macroName,\n    compendiumName = \"xdy-pf2e-workbench.asymonous-benefactor-macros-internal\"\n) {\n    const pack = game.packs.get(compendiumName);\n    if (pack) {\n        const macro_data = (await pack.getDocuments()).find((i) => i.data.name === macroName)?.toObject();\n        if (macro_data) {\n            const temp_macro = new Macro(macro_data);\n            temp_macro.data.permission.default = CONST.DOCUMENT_PERMISSION_LEVELS.OWNER;\n            temp_macro.execute();\n        } else {\n            ui.notifications.error(\"Macro \" + macroName + \" not found\");\n        }\n    } else {\n        ui.notifications.error(\"Compendium \" + compendiumName + \" not found\");\n    }\n}\n_executeMacroByName('XDY DO_NOT_IMPORT Treat Wounds and Battle Medicine');\n\n/* This compendium link macro is based on one originally posted by DrentalBot: https://discord.com/channels/880968862240239708/880975811279204402/910490804554973274; and modified by Mark Pearce https://discord.com/channels/880968862240239708/880969174661353484/972962446098702376 */","flags":{"core":{"sourceId":"Compendium.xdy-pf2e-workbench.asymonous-benefactor-macros.0OcYciDnHc5Dhmk6"}},"img":"systems/pf2e/icons/conditions/wounded.webp","name":"Treat Wounds and Battle Medicine","scope":"global","type":"script","ownership":{"default":1,"LyRgQdXNFeeP8bOE":3,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.4.2","coreVersion":"10.290","createdTime":1667858586314,"modifiedTime":1670375698564,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"folder":null,"sort":0,"_id":"79py4VrmGxCv91ZX"}
{"name":"Burmese Male Names","type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.simple-name-generator.macros.xNuIZ76dSUJTe7pM"}},"scope":"global","command":"SimpleNameGeneratorMacros.generateSimpleName(\"burmese\", \"male\")","author":"GrjyIKCXZF9zDqJk","img":"modules/simple-name-generator/icons/male.png","ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669164454109,"modifiedTime":1669164454109,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"folder":null,"sort":0,"_id":"7tiRGZkYg3Tezd4e"}
{"name":"New Macro","type":"script","scope":"global","author":"GrjyIKCXZF9zDqJk","img":"icons/svg/dice-target.svg","command":"const table = game.tables.getName(\"01 - Ancestralidade\");  \nresult = await table.draw({displayChat: false});  \nresultMessage = result.results[0].getChatText();  \nChatMessage.create({  \n    user : game.user._id,  \n    content: \"Ancestralidade: \" + resultMessage,\n    whisper: ChatMessage.getWhisperRecipients(\"Your (GM) handle here\")\n});\n\nconst table = game.tables.getName(\"02 - Função\");  \nresult = await table.draw({displayChat: false});  \nresultMessage = result.results[0].getChatText();  \nChatMessage.create({  \n    user : game.user._id,  \n    content: \"Função: \" + resultMessage,\n    whisper: ChatMessage.getWhisperRecipients(\"Your (GM) handle here\")\n});\n\nconst table = game.tables.getName(\"03 - Localidade\");  \nresult = await table.draw({displayChat: false});  \nresultMessage = result.results[0].getChatText();  \nChatMessage.create({  \n    user : game.user._id,  \n    content: \"Localidade: \" + resultMessage,\n    whisper: ChatMessage.getWhisperRecipients(\"Your (GM) handle here\")\n});\n\nconst table = game.tables.getName(\"04 - Finaceiro\");  \nresult = await table.draw({displayChat: false});  \nresultMessage = result.results[0].getChatText();  \nChatMessage.create({  \n    user : game.user._id,  \n    content: \"Finaceiro: \" + resultMessage,\n    whisper: ChatMessage.getWhisperRecipients(\"Your (GM) handle here\")\n});\n\nconst table = game.tables.getName(\"05 - Origem\");  \nresult = await table.draw({displayChat: false});  \nresultMessage = result.results[0].getChatText();  \nChatMessage.create({  \n    user : game.user._id,  \n    content: \"Origem: \" + resultMessage,\n    whisper: ChatMessage.getWhisperRecipients(\"Your (GM) handle here\")\n});","folder":null,"sort":0,"ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.4.2","coreVersion":"10.290","createdTime":1670130108225,"modifiedTime":1670130622923,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"9jReW3hcxKFi5mXk"}
{"name":"00 - A - Delete filters on Selected","type":"script","author":"aANK6z1SbjUXOpig","img":"modules/tokenmagic/gui/macros/images/00%20-%20A%20-%20Delete%20filters%20on%20Selected.webp","scope":"global","command":"// Delete all filters on the selected tokens/tiles\nawait TokenMagic.deleteFiltersOnSelected();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.DCRnfJDBd25fOQxc"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"aANK6z1SbjUXOpig":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669046343956,"modifiedTime":1669046343956,"lastModifiedBy":"aANK6z1SbjUXOpig"},"_id":"EcwriVvoFANNn1Mk"}
{"author":"GrjyIKCXZF9zDqJk","command":"game.pf2e.gm.perceptionForSelected(event);","img":"systems/pf2e/icons/spells/vision-of-weakness.webp","name":"Perception for Selected Tokens","ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"scope":"global","type":"script","flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.084MOWWSEVNwpHVG"}},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870230231,"modifiedTime":1667870230231,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"G0WDnOXeRdmbpqLm"}
{"name":"34 - T02 - Dead (splash)","type":"script","author":"GrjyIKCXZF9zDqJk","img":"modules/tokenmagic/gui/macros/images/34%20-%20T02%20-%20Dead%20%28splash%29.webp","scope":"global","command":"let params =\n    [{\n        filterType: \"splash\",\n        filterId: \"mySplash\",\n        color: 0x900505,\n        padding: 30,\n        time: Math.random()*1000,\n        seed: Math.random()/100,\n        splashFactor: 2,\n        spread: 7,\n        blend: 1,\n        dimX: 1,\n        dimY: 1,\n        cut: true,\n        textureAlphaBlend: false\n    }];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.WyiMXpscxVhgE1zy"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669686564659,"modifiedTime":1669686564659,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"IbgD11o90myMTl3D"}
{"name":"11 - Blur","type":"script","author":"GrjyIKCXZF9zDqJk","img":"modules/tokenmagic/gui/macros/images/11%20-%20Blur.webp","scope":"global","command":"let params =\n[{\n    filterType: \"blur\",\n    filterId: \"myBlur\",\n    padding: 10,\n    quality: 4.0,\n    blur: 0,\n    blurX: 0,\n    blurY: 0,\n    animated:\n    {\n        blurX: \n        { \n           active: true, \n           animType: \"syncCosOscillation\", \n           loopDuration: 500, \n           val1: 0, \n           val2: 6\n        },\n        blurY: \n        { \n           active: true, \n           animType: \"syncCosOscillation\", \n           loopDuration: 7500, \n           val1: 0, \n           val2: 6}\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.CdFhWPKBMb5wj7cM"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.4.2","coreVersion":"10.290","createdTime":1670015128991,"modifiedTime":1670015151083,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"Ieb9DlelHQMrKxKg"}
{"command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (actors.length === 0 && game.user.character) actors.push(game.user.character);\nif (actors.length === 0) {\n    const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n    return ui.notifications.error(message);\n}\n\nconst ITEM_UUID = \"Compendium.pf2e.equipment-effects.KSvkfMqMQ8mlGLiz\"; // Effect: Goggles of Night\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags = mergeObject(source.flags ?? {}, { core: { sourceId: ITEM_UUID } });\n\nfor (const actor of actors) {\n    const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === ITEM_UUID);\n    if (existing) {\n        await existing.delete();\n    } else {\n        await actor.createEmbeddedDocuments(\"Item\", [source]);\n    }\n}","name":"Effect: Goggles of Night","type":"script","img":"systems/pf2e/icons/equipment/worn-items/other-worn-items/goggles-of-night.webp","author":"aANK6z1SbjUXOpig","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"aANK6z1SbjUXOpig":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669046137556,"modifiedTime":1669046137556,"lastModifiedBy":"aANK6z1SbjUXOpig"},"_id":"J5VUaS1GkrWZYEon"}
{"name":"Chinese Female Names","type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.simple-name-generator.macros.S22vJ88nhOmCygzN"}},"scope":"global","command":"SimpleNameGeneratorMacros.generateSimpleName(\"chinese\", \"female\")","author":"GrjyIKCXZF9zDqJk","img":"modules/simple-name-generator/icons/female.png","ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669164490377,"modifiedTime":1669164490377,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"folder":null,"sort":0,"_id":"KC3VB0As48V26ei1"}
{"name":"New Macro","type":"chat","scope":"global","author":"GrjyIKCXZF9zDqJk","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669670403302,"modifiedTime":1669670403302,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"Kn1bTJAbmTgbDIFl"}
{"name":"New Macro","type":"chat","scope":"global","author":"hdDjNYWprSe1uLPl","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"hdDjNYWprSe1uLPl":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669069790482,"modifiedTime":1669069790482,"lastModifiedBy":"hdDjNYWprSe1uLPl"},"_id":"OHBKjJYYlkBb7Vkk"}
{"name":"New Macro","type":"chat","scope":"global","author":"JK2ep9hdWFidAQo8","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"JK2ep9hdWFidAQo8":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669673293699,"modifiedTime":1669673293699,"lastModifiedBy":"JK2ep9hdWFidAQo8"},"_id":"TxM8fHCsc2GJu7AB"}
{"author":"GrjyIKCXZF9zDqJk","command":"PF2EPersistentDamage.showDialog();","flags":{"core":{"sourceId":"Compendium.pf2e-persistent-damage.pf2e-persistent-damage-macros.pwyjwfc6dyf73p7f"}},"img":"systems/pf2e/icons/features/classes/brutality.webp","name":"Add Persistent Damage","scope":"global","type":"script","ownership":{"default":1,"GrjyIKCXZF9zDqJk":3},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870256772,"modifiedTime":1667870256772,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"WGlMwXNbFHSS7VGI"}
{"name":"Gerando NPC","type":"script","scope":"global","author":"GrjyIKCXZF9zDqJk","img":"icons/environment/people/group.webp","command":"await game.tables.getName('01 - Ancestralidade').draw();\nawait game.tables.getName('02 - Função').draw();\nawait game.tables.getName('03 - Localidade').draw();\nawait game.tables.getName('04 - Finaceiro').draw();\nawait game.tables.getName('05 - Origem').draw();","folder":null,"sort":0,"ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.4.2","coreVersion":"10.290","createdTime":1670127576935,"modifiedTime":1670158913577,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"XPlT4e3NRrwBkF5z"}
{"name":"New Macro","type":"chat","scope":"global","author":"A3Rb3nFtdKAzUSdO","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"A3Rb3nFtdKAzUSdO":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669672275677,"modifiedTime":1669672275677,"lastModifiedBy":"A3Rb3nFtdKAzUSdO"},"_id":"YjVXDNFt26ZwuZpF"}
{"name":"36 - T01 - Turn into Mystery Man (polymorph)","type":"script","flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.lZefFMIYs8WYRpdZ"}},"scope":"global","command":"// This macro contains a small tutorial : how to work with non-infinite loops and halfCosOscillation animType\n\n// Click once to transform your token and again to revert to the original shape (thank to halfCosOscillation)\n\n// There is 9 types of metamorphose\n// 1 - Simple transition\n// 2 - Dreamy\n// 3 - Twist\n// 4 - Water drop\n// 5 - TV Noise\n// 6 - Morphing\n// 7 - Take off/Put on you disguise!\n// 8 - Wind\n// 9 - Hologram\n\n// change the type here\nlet transitionType = 4;\n\n// change the target image here\nlet targetImagePath = \"https://ibb.co/mhMBfGF\";\n\n// declare filter id (think to change the id for personal macros)\n// each filterId should be unique to a player or gm to prevent collisions\n// example : \"brutusChthulhuPolymorph\"\nlet polymorphFilterId = \"myPolymorph\";\n\n// we put our code into an async function that will be called later\nlet polymorphFunc = async function () {\n\n    for (const token of canvas.tokens.controlled) {\n        let params;\n        \n        // Is the filter already activated on the placeable ? \n        if (token.TMFXhasFilterId(polymorphFilterId)) {\n           \n            // Yes. So we update the type in the general section and loops + active in the progress animated section, to activate the animation for just one loop.\n            // \"type\" to allow you to change the animation type\n            // \"active\" to say at Token Magic : \"Hey filter! It's time to work again!\"\n            // \"loops\" so that Token Magic can know how many loops it needs to schedule for the animation.\n            // Each animation loop decreases \"loops\" by one. When \"loops\" reach 0, \"active\" becomes \"false\" and the animation will be dormant again.\n            // Thank to the halfCosOscillation, a loop brings the value of the property from val1 to val2. A second loop is needed to bring val2 to val1. This is useful for monitoring progress with back and forth movements.\n            params =\n                [{\n                    filterType: \"polymorph\",\n                    filterId: polymorphFilterId,\n                    type: transitionType,\n                    animated:\n                    {\n                        progress:\n                        {\n                            active: true,\n                            loops: 1\n                        }\n                    }\n                }];\n\n        } else {\n\n            // No. So we create the entirety of the filter\n            params =\n                [{\n                    filterType: \"polymorph\",\n                    filterId: polymorphFilterId,\n                    type: transitionType,\n                    padding: 70,\n                    magnify: 1,\n                    imagePath: https://ibb.co/mhMBfGF,\n                    animated:\n                    {\n                        progress:\n                        {\n                            active: true,\n                            animType: \"halfCosOscillation\",\n                            val1: 0,\n                            val2: 100,\n                            loops: 1,\n                            loopDuration: 1000\n                        }\n                    }\n                }];\n        }\n\n        // all functions that add, update or delete filters are asynchronous\n        // if you are in a loop AND/OR you chain these functions, it is MANDATORY to await them\n        // otherwise, data persistence may not works.\n        // this is the reason why we use an async function (we cant use await in a non-async function)\n        // avoid awaiting in a forEach loop, use \"for\" or \"for/of\" loop.\n        await token.TMFXaddUpdateFilters(params);\n    }\n\n};\n\n// polymorph async function call\npolymorphFunc();","author":"aANK6z1SbjUXOpig","img":"modules/tokenmagic/gui/macros/images/36%20-%20T01%20-%20Turn%20into%20Mystery%20Man%20%28polymorph%29.webp","ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"aANK6z1SbjUXOpig":3},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669046338246,"modifiedTime":1669067904531,"lastModifiedBy":"aANK6z1SbjUXOpig"},"_id":"Zk6YPvNwZbfY2GRh"}
{"name":"00 - A - Delete filters on Selected","type":"script","author":"GrjyIKCXZF9zDqJk","img":"modules/tokenmagic/gui/macros/images/00%20-%20A%20-%20Delete%20filters%20on%20Selected.webp","scope":"global","command":"// Delete all filters on the selected tokens/tiles\nawait TokenMagic.deleteFiltersOnSelected();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.DCRnfJDBd25fOQxc"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669688097486,"modifiedTime":1669688097486,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"cBAVrS8ZKohFVIhO"}
{"name":"Burmese Female Names","type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.simple-name-generator.macros.VwyhZIRYgZ1HuYj1"}},"scope":"global","command":"SimpleNameGeneratorMacros.generateSimpleName(\"burmese\", \"female\")","author":"GrjyIKCXZF9zDqJk","img":"modules/simple-name-generator/icons/female.png","ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669164467038,"modifiedTime":1669164518617,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"folder":null,"sort":0,"_id":"fcFH0TOu2qp0v06i"}
{"author":"GrjyIKCXZF9zDqJk","command":"/**\n * @typedef {{data: {data: {details: {level: number|string|undefined|null, isComplex: boolean}}, type: string}}} Hazard\n */\n/**\n * @param actors {Array<Hazard>}\n * @param type {string}\n * @returns {Array<HazardLevel>}\n */\nfunction getHazardLevels(actors) {\n    return actors.filter((a) => a.data.type === \"hazard\");\n}\n/**\n * @typedef {{data: {data: {details: {level: {value: number|string|undefined|null}}}, type: string}}} Actor\n */\n/**\n * @param actors {Array<Actor>}\n * @param type {string}\n * @returns {Array<number>}\n */\nfunction getLevels(actors, type) {\n    return actors.filter((a) => a.data.type === type).map((a) => parseInt(a.data.data.details.level.value ?? \"1\", 10));\n}\n/**\n * @param xp {XP}\n * @returns {string}\n */\nfunction dialogTemplate(xp) {\n    return `\n<h2>XP</h2>\n<table>\n    <tr>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.PartySize\")}</th>\n        <td>${xp.partySize}</td>\n    </tr>\n    <tr>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.PartyLevel\")}</th>\n        <td>${xp.partyLevel}</td>\n    </tr>\n    <tr>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.Threat\")}</th>\n        <td>${game.i18n.localize(\"PF2E.Encounter.Budget.Threats.\"+xp.rating)} (${xp.totalXP} XP)</td>\n    </tr>\n    <tr>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.Reward\")}</th>\n        <td>${xp.xpPerPlayer} XP</td>\n    </tr>\n</table>\n<h2>${game.i18n.localize(\"PF2E.Encounter.Budget.EncounterBudget\")}</h2>\n<table class=\"pf2-table\">\n    <tr>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.Threat\")}</th>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.XPBudget\")}</th>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.XPNeeded\")}</th>\n        <th>${game.i18n.localize(\"PF2E.Encounter.Budget.Reward\")}</th>\n    </tr>\n    <tr>\n        <td>${game.i18n.localize(\"PF2E.Encounter.Budget.Threats.trivial\")}</td>\n        <td>${xp.encounterBudgets.trivial}</td>\n        <td>${xp.encounterBudgets.trivial - xp.totalXP}</td>\n        <td>40</td>\n    </tr>\n    <tr>\n        <td>${game.i18n.localize(\"PF2E.Encounter.Budget.Threats.low\")}</td>\n        <td>${xp.encounterBudgets.low}</td>\n        <td>${xp.encounterBudgets.low - xp.totalXP}</td>\n        <td>60</td>\n    </tr>\n    <tr>\n        <td>${game.i18n.localize(\"PF2E.Encounter.Budget.Threats.moderate\")}</td>\n        <td>${xp.encounterBudgets.moderate}</td>\n        <td>${xp.encounterBudgets.moderate - xp.totalXP}</td>\n        <td>80</td>\n    </tr>\n    <tr>\n        <td>${game.i18n.localize(\"PF2E.Encounter.Budget.Threats.severe\")}</td>\n        <td>${xp.encounterBudgets.severe}</td>\n        <td>${xp.encounterBudgets.severe - xp.totalXP}</td>\n        <td>120</td>\n    </tr>\n    <tr>\n        <td>${game.i18n.localize(\"PF2E.Encounter.Budget.Threats.extreme\")}</td>\n        <td>${xp.encounterBudgets.extreme}</td>\n        <td>${xp.encounterBudgets.extreme - xp.totalXP}</td>\n        <td>160</td>\n    </tr>\n</table>\n<h2>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureXPAndRole\")}</h2>\n<table class=\"pf2-table\">\n    <tr>\n        <th>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevel\")}</th>\n        <th>XP</th>\n        <th>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.SuggestedRole\")}</th>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel - 4}</td>\n        <td>10</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.-4\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel - 3}</td>\n        <td>15</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.-3\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel - 2}</td>\n        <td>20</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.-2\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel - 1}</td>\n        <td>30</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.-1\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel}</td>\n        <td>40</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.0\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel + 1}</td>\n        <td>60</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.1\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel + 2}</td>\n        <td>80</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.2\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel + 3}</td>\n        <td>120</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.3\")}</td>\n    </tr>\n    <tr>\n        <td>${xp.partyLevel + 4}</td>\n        <td>160</td>\n        <td>${game.i18n.localize(\"PF2E.Encounter.CreatureXPAndRole.CreatureLevels.4\")}</td>\n    </tr>\n</table>`;\n}\nconst askLevelPopupTemplate = () => {\n    const partySize = parseInt(localStorage.getItem(\"xpMacroPartySize\") ?? 4, 10);\n    const partyLevel = parseInt(localStorage.getItem(\"xpMacroPartyLevel\") ?? 1, 10);\n    return `\n    <form>\n    <div class=\"form-group\">\n        <label>${game.i18n.localize(\"PF2E.Encounter.Budget.PartySize\")}</label>\n        <input id=\"party-size\" name=\"party-size\" type=\"number\" value=\"${partySize}\">\n    </div>\n    <div class=\"form-group\">\n        <label>${game.i18n.localize(\"PF2E.Encounter.Budget.PartyLevel\")}</label>\n        <input id=\"party-level\" name=\"party-level\" type=\"number\" value=\"${partyLevel}\">\n    </div>\n    </form>\n    `;\n};\n/**\n * @param partyLevel {number}\n * @param partySize {number}\n * @param npcLevels {Array<number>}\n * @param hazardLevels {Array<HazardLevel>}\n */\nfunction showXP(partyLevel, partySize, npcLevels, hazardLevels) {\n    const xp = game.pf2e.gm.calculateXP(partyLevel, partySize, npcLevels, hazardLevels, {\n        proficiencyWithoutLevel: game.settings.get(\"pf2e\", \"proficiencyVariant\") === \"ProficiencyWithoutLevel\",\n    });\n    new Dialog({\n        title: \"XP\",\n        content: dialogTemplate(xp),\n        buttons: {},\n    }).render(true);\n}\n/**\n * @param npcLevels {Array<number>}\n * @param hazardLevels {Array<HazardLevel>}\n */\nfunction askPartyLevelAndSize(npcLevels, hazardLevels) {\n    new Dialog({\n        title: \"Party Information\",\n        content: askLevelPopupTemplate,\n        buttons: {\n            no: {\n                icon: '<i class=\"fas fa-times\"></i>',\n                label: \"Cancel\",\n            },\n            yes: {\n                icon: '<i class=\"fas fa-calculator\"></i>',\n                label: \"Calculate XP\",\n                callback: ($html) => {\n                    const partySize = parseInt($html[0].querySelector('[name=\"party-size\"]').value, 10) ?? 1;\n                    const partyLevel = parseInt($html[0].querySelector('[name=\"party-level\"]').value, 10) ?? 1;\n                    // persist for future uses\n                    localStorage.setItem(\"xpMacroPartySize\", partySize);\n                    localStorage.setItem(\"xpMacroPartyLevel\", partyLevel);\n                    showXP(partyLevel, partySize, npcLevels, hazardLevels);\n                },\n            },\n        },\n        default: \"yes\",\n    }).render(true);\n}\nfunction main() {\n    const actors = canvas.tokens.controlled.map((a) => a.actor);\n    const npcLevels = getLevels(actors, \"npc\");\n    const pcLevels = getLevels(actors, \"character\");\n    const hazardLevels = getHazardLevels(actors);\n    if (npcLevels.length === 0 && hazardLevels.length === 0) {\n        ui.notifications.error(`You must select at least one npc and/or hazard token and optionally all PC tokens`);\n        return;\n    }\n    if (pcLevels.length === 0) {\n        askPartyLevelAndSize(npcLevels, hazardLevels);\n    } else {\n        showXP(pcLevels[0], pcLevels.length, npcLevels, hazardLevels);\n    }\n}\nmain();","img":"systems/pf2e/icons/spells/athletic-rush.webp","name":"XP","ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"scope":"global","type":"script","flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.MAHxEeGf31wqv3jp"}},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870239441,"modifiedTime":1667870239441,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"hx6JWGULjYn2QILM"}
{"name":"36 - T01 - Turn into Mystery Man (polymorph)","type":"script","flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.lZefFMIYs8WYRpdZ"}},"scope":"global","command":"// This macro contains a small tutorial : how to work with non-infinite loops and halfCosOscillation animType\n\n// Click once to transform your token and again to revert to the original shape (thank to halfCosOscillation)\n\n// There is 9 types of metamorphose\n// 1 - Simple transition\n// 2 - Dreamy\n// 3 - Twist\n// 4 - Water drop\n// 5 - TV Noise\n// 6 - Morphing\n// 7 - Take off/Put on you disguise!\n// 8 - Wind\n// 9 - Hologram\n\n// change the type here\nlet transitionType = 4;\n\n// change the target image here\nlet targetImagePath = \"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQgZBCk9PB660BFagNbICptZDf1ANfYcAu-Ngi3pu9riwXpIgd1z2axeV9DWYE_W10JUxs&usqp=CAU\";\n\n// declare filter id (think to change the id for personal macros)\n// each filterId should be unique to a player or gm to prevent collisions\n// example : \"brutusChthulhuPolymorph\"\nlet polymorphFilterId = \"myPolymorph\";\n\n// we put our code into an async function that will be called later\nlet polymorphFunc = async function () {\n\n    for (const token of canvas.tokens.controlled) {\n        let params;\n        \n        // Is the filter already activated on the placeable ? \n        if (token.TMFXhasFilterId(polymorphFilterId)) {\n           \n            // Yes. So we update the type in the general section and loops + active in the progress animated section, to activate the animation for just one loop.\n            // \"type\" to allow you to change the animation type\n            // \"active\" to say at Token Magic : \"Hey filter! It's time to work again!\"\n            // \"loops\" so that Token Magic can know how many loops it needs to schedule for the animation.\n            // Each animation loop decreases \"loops\" by one. When \"loops\" reach 0, \"active\" becomes \"false\" and the animation will be dormant again.\n            // Thank to the halfCosOscillation, a loop brings the value of the property from val1 to val2. A second loop is needed to bring val2 to val1. This is useful for monitoring progress with back and forth movements.\n            params =\n                [{\n                    filterType: \"polymorph\",\n                    filterId: polymorphFilterId,\n                    type: transitionType,\n                    animated:\n                    {\n                        progress:\n                        {\n                            active: true,\n                            loops: 1\n                        }\n                    }\n                }];\n\n        } else {\n\n            // No. So we create the entirety of the filter\n            params =\n                [{\n                    filterType: \"polymorph\",\n                    filterId: polymorphFilterId,\n                    type: transitionType,\n                    padding: 70,\n                    magnify: 1,\n                    imagePath: targetImagePath,\n                    animated:\n                    {\n                        progress:\n                        {\n                            active: true,\n                            animType: \"halfCosOscillation\",\n                            val1: 0,\n                            val2: 100,\n                            loops: 1,\n                            loopDuration: 1000\n                        }\n                    }\n                }];\n        }\n\n        // all functions that add, update or delete filters are asynchronous\n        // if you are in a loop AND/OR you chain these functions, it is MANDATORY to await them\n        // otherwise, data persistence may not works.\n        // this is the reason why we use an async function (we cant use await in a non-async function)\n        // avoid awaiting in a forEach loop, use \"for\" or \"for/of\" loop.\n        await token.TMFXaddUpdateFilters(params);\n    }\n\n};\n\n// polymorph async function call\npolymorphFunc();","author":"aANK6z1SbjUXOpig","img":"modules/tokenmagic/gui/macros/images/36%20-%20T01%20-%20Turn%20into%20Mystery%20Man%20%28polymorph%29.webp","ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"aANK6z1SbjUXOpig":3},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669067979833,"modifiedTime":1669680173091,"lastModifiedBy":"aANK6z1SbjUXOpig"},"_id":"lVh13Mmgu3Px8Exf"}
{"name":"Display Falha Critica","type":"script","img":"icons/skills/melee/shield-damaged-broken-blue.webp","command":"Hotbar.toggleDocumentSheet(\"RollTable.JWZGF3otdFA2O6Vw\")","author":"GrjyIKCXZF9zDqJk","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"flags":{"advanced-macros":{"runAsGM":false,"runForEveryone":false,"runForSpecificUser":""}},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669670140023,"modifiedTime":1669675316531,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"nxV9KD1bJDUdP8Dr"}
{"name":"16 - Inner Fog","type":"script","author":"GrjyIKCXZF9zDqJk","img":"modules/tokenmagic/gui/macros/images/16%20-%20Inner%20Fog.webp","scope":"global","command":"let params =\n[{\n    filterType: \"fog\",\n    filterId: \"myFog\",\n    color: 0x000000,\n    density: 0.65,\n    time: 0,\n    dimX: 1,\n    dimY: 1,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 2.2, \n        animType: \"move\" \n      }\n    }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Edw0KaZiBtWEG86g"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"GrjyIKCXZF9zDqJk":3},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1669688326853,"modifiedTime":1669688326853,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"qBmsWvhDlZZvx52k"}
{"command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (actors.length === 0 && game.user.character) actors.push(game.user.character);\nif (actors.length === 0) {\n    const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n    return ui.notifications.error(message);\n}\n\nconst ITEM_UUID = \"Compendium.pf2e-persistent-damage.pf2e-persistent-damage-effects.NyLWYfF72qdSNRAj\"; // Effect: Fast Healing 1\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags = mergeObject(source.flags ?? {}, { core: { sourceId: ITEM_UUID } });\n\nfor (const actor of actors) {\n    const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === ITEM_UUID);\n    if (existing) {\n        await existing.delete();\n    } else {\n        await actor.createEmbeddedDocuments(\"Item\", [source]);\n    }\n}","name":"Effect: Fast Healing 1","type":"script","img":"systems/pf2e/icons/spells/heal-companion.webp","author":"GrjyIKCXZF9zDqJk","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"GrjyIKCXZF9zDqJk":3},"flags":{},"_stats":{"systemId":"pf2e","systemVersion":"4.4.2","coreVersion":"10.290","createdTime":1670155955982,"modifiedTime":1670155955982,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"sbEP3jWwsWnqcwIT"}
{"name":"Darkness","type":"script","scope":"global","author":"GrjyIKCXZF9zDqJk","img":"systems/pf2e/icons/spells/darkness.webp","command":"// Just updates the template with perfect vision data.\n// If used standalone, it updates the latest placed template.\n\nconst flag = {\n    \"perfect-vision\": {\n        \"visionLimitation\": {\n            \"enabled\": true,\n            \"sight\": 0,\n            \"sound\": null,\n            \"move\": null,\n            \"other\": null,\n            \"detection\": {\n                \"basicSight\": 0,\n                \"feelTremor\": null,\n                \"hearing\": null,\n                \"seeAll\": 0,\n                \"seeInvisibility\": 0,\n                \"senseAll\": null,\n                \"senseInvisibility\": null\n            }\n        }\n    }\n}\n\nconst template = args.length ? args[1].templateData : canvas.templates.placeables[canvas.templates.placeables.length - 1].document\n\ntemplate.update({\"flags\": flag})","ownership":{"default":0,"BHRwUaMa68cNSVcP":3,"GrjyIKCXZF9zDqJk":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.ZrTz8dusj2oVDRXi"},"cf":{"id":"temp_8f8hkx7i8fo"}},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.290","createdTime":1664155646051,"modifiedTime":1669682840441,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"folder":null,"sort":0,"_id":"twjCEHdHPmUZ9Xbv"}
{"author":"GrjyIKCXZF9zDqJk","command":"game.pf2e.actions.earnIncome(actor ?? game.user.character, event);","img":"systems/pf2e/icons/equipment/treasure/currency/gold-pieces.webp","name":"Earn Income","ownership":{"default":1,"GrjyIKCXZF9zDqJk":3},"scope":"global","type":"script","flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.mxHKWibjPrgfJTDg"}},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870236071,"modifiedTime":1667870236071,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"uYcXzkAr4yIyE4AJ"}
{"author":"GrjyIKCXZF9zDqJk","command":"game.pf2e.actions.raiseAShield({ actors: [token?.actor ?? actor ?? game.user.character].filter((actor) => actor) })","img":"systems/pf2e/icons/actions/raise-a-shield.webp","name":"Raise a Shield","ownership":{"default":1,"GrjyIKCXZF9zDqJk":3},"scope":"global","type":"script","flags":{"core":{"sourceId":"Compendium.pf2e.action-macros.4hfQEMiEOBbqelAh"}},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870167012,"modifiedTime":1667870167012,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"x4s6aZT2kgTKKaQk"}
{"author":"GrjyIKCXZF9zDqJk","command":"/** This compendium link macro will always call the most recent version from the compendium included with this module meaning you do not need to reimport newer versions. The source of the macros that get called is https://gitlab.com/symonsch/my-foundryvtt-macros/-/tree/main/PF2e */\nasync function _executeMacroByName(\n    macroName,\n    compendiumName = \"xdy-pf2e-workbench.asymonous-benefactor-macros-internal\"\n) {\n    const pack = game.packs.get(compendiumName);\n    if (pack) {\n        const macro_data = (await pack.getDocuments()).find((i) => i.data.name === macroName)?.toObject();\n        if (macro_data) {\n            const temp_macro = new Macro(macro_data);\n            temp_macro.data.permission.default = CONST.DOCUMENT_PERMISSION_LEVELS.OWNER;\n            temp_macro.execute();\n        } else {\n            ui.notifications.error(\"Macro \" + macroName + \" not found\");\n        }\n    } else {\n        ui.notifications.error(\"Compendium \" + compendiumName + \" not found\");\n    }\n}\n_executeMacroByName('XDY DO_NOT_IMPORT Loot Generator');\n\n/* This compendium link macro is based on one originally posted by DrentalBot: https://discord.com/channels/880968862240239708/880975811279204402/910490804554973274; and modified by Mark Pearce https://discord.com/channels/880968862240239708/880969174661353484/972962446098702376 */","flags":{"core":{"sourceId":"Compendium.xdy-pf2e-workbench.asymonous-benefactor-macros.lVZIrmfEpkSCAFf8"}},"img":"systems/pf2e/icons/equipment/held-items/earthsight-box.webp","name":"Loot Generator","scope":"global","type":"script","ownership":{"default":1,"GrjyIKCXZF9zDqJk":3},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870305469,"modifiedTime":1667870305469,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"yNe7SAxTjTUd6vcM"}
{"author":"GrjyIKCXZF9zDqJk","command":"PF2EPersistentDamage.processHealing(canvas.tokens.controlled);","flags":{"core":{"sourceId":"Compendium.pf2e-persistent-damage.pf2e-persistent-damage-macros.mh3yl3kgkp8onnom"}},"img":"systems/pf2e/icons/spells/regeneration.webp","name":"Process Healing (Regen / Fast Healing)","scope":"global","type":"script","ownership":{"default":1,"GrjyIKCXZF9zDqJk":3},"folder":null,"sort":0,"_stats":{"systemId":"pf2e","systemVersion":"4.3.3","coreVersion":"10.288","createdTime":1667870259257,"modifiedTime":1667870259257,"lastModifiedBy":"GrjyIKCXZF9zDqJk"},"_id":"z4Ft8D4tnav7wyKw"}
